(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{default:()=>ot});const a=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/IndexPage"];var s=t.n(o);const r=flarum.core.compat["common/components/LinkButton"];var i=t.n(r);const n=flarum.core.compat["common/Model"];var c=t.n(n);const l=flarum.core.compat["tags/models/Tag"];var d=t.n(l);function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function g(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,u(t,e)}const h=flarum.core.compat["forum/app"];var p=t.n(h);const f=flarum.core.compat["common/components/Page"];var v=t.n(f);const y=flarum.core.compat["common/components/LoadingIndicator"];var C=t.n(y);const b=flarum.core.compat["common/helpers/listItems"];var w=t.n(b);const T=flarum.core.compat["common/utils/ItemList"];var k=t.n(T);const N=flarum.core.compat["common/utils/extractText"];var I=t.n(N);const P=flarum.core.compat["common/utils/classList"];var L=t.n(P);const x=flarum.core.compat["tags/utils/sortTags"];var A=t.n(x);const D=flarum.core.compat["tags/helpers/tagLabel"];var M=t.n(D);const _=flarum.core.compat["common/Component"];var S=t.n(_);const O=flarum.core.compat["common/components/Link"];var U=t.n(O);const B=flarum.core.compat["common/helpers/icon"];var W=t.n(B),j=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var a=e.prototype;return a.view=function(){return m("div",{class:L()("StatWidget",{"Categories-compactMobileModeEnabled":!!p().forum.attribute("categories.compactMobile")})},this.content().toArray())},a.content=function(){var t=new(k());return t.add("count",m("div",{class:"StatWidget-count"},this.attrs.count),100),t.add("label",m("div",{class:"StatWidget-label",style:this.attrs.filter},m("span",{className:"Categories-showOnMobile"},W()(this.attrs.icon)),m("span",{className:"Categories-hideOnMobile"},this.attrs.label)),80),t},e}(S());const E=flarum.core.compat["common/helpers/avatar"];var R=t.n(E);const V=flarum.core.compat["common/helpers/username"];var F=t.n(V);const z=flarum.core.compat["common/helpers/humanTime"];var H=t.n(z);const G=flarum.core.compat["common/utils/string"],q=flarum.core.compat["forum/components/UserCard"];var J=t.n(q);const K=flarum.core.compat["common/helpers/textContrastClass"];var Q=t.n(K),X=function(t){function e(){for(var e,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).cardVisible=void 0,e}g(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.cardVisible=!1},a.view=function(){var t,e=this.attrs.discussion;return e?(e.lastPostedUser(),m(U(),{class:"LastDiscussion",href:p().route.discussion(e,null!=(t=e.lastPostNumber())?t:0)},this.content().toArray())):m("div",{class:"LastDiscussion"},p().translator.trans("askvortsov-categories.forum.last_discussion_widget.no_discussions"))},a.content=function(){var t=new(k()),e=this.attrs.discussion,a=e.lastPostedUser(),o=this.attrs.selectedTag.isChild?"text-contrast--dark":Q()(this.attrs.selectedTag.tag.color()),s="text-contrast--light"==o?"filter: brightness(85%);":"filter: brightness(200%);";t.add("avatar",m(U(),{className:"LastDiscussion-avatar",href:a?p().route.user(a):"#","aria-label":I()(F()(a))},!!a&&R()(a)),100),t.add("mainContent",m("div",{class:L()("LastDiscussion-content",o)},m("div",{class:"LastDiscussion-bottomRow",style:s},H()(e.lastPostedAt())," ",m(U(),{className:L()("LastDiscussion-usernameLink",o),href:a?p().route.user(a):"#"},m("span",{style:{display:"inline",margin:"0 4px"},role:"presentation"},"|"),F()(a))),m("div",{class:"LastDiscussion-topRow"},(0,G.truncate)(e.title(),26))),50);var r=null;return a&&this.cardVisible&&(r=J().component({user:a,className:"UserCard--popover",controlsButtonClassName:"Button Button--icon Button--flat"})),t.add("card",m("div",{class:"LastDiscussion-userCardContainer"},r),10),t},a.oncreate=function(e){var a,o=this;t.prototype.oncreate.call(this,e),this.$().on("mouseover",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(a),a=window.setTimeout(o.showCard.bind(o),300)})).on("mouseout",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(a),a=window.setTimeout(o.hideCard.bind(o),150)}))},a.onremove=function(e){t.prototype.onremove.call(this,e),this.$().off("mouseover mouseout")},a.showCard=function(){var t=this;this.cardVisible=!0,m.redraw(),setTimeout((function(){return t.$(".UserCard").addClass("in")}))},a.hideCard=function(){$(".UserCard").removeClass("in"),this.cardVisible=!1,m.redraw()},e}(S()),Y=function(t){function e(){for(var e,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).tag=void 0,e.isChild=void 0,e.collapsed=void 0,e.compactMobileMode=void 0,e.tagLocked=void 0,e}g(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.tag=this.attrs.model,this.isChild=null!=this.attrs.parent&&null!=this.attrs.parent,this.collapsed=!1,"function"==typeof this.tag.isUnlocked&&(!this.tag.isGroupProtected()&&!this.tag.isPasswordProtected()||this.tag.isUnlocked()||(this.tagLocked={icon:this.tag.isPasswordProtected()?W()("fas fa-lock"):W()("fas fa-user-lock"),text:this.tag.isPasswordProtected()?p().translator.trans("datlechin-tag-passwords.forum.tags_page.password_protected"):p().translator.trans("datlechin-tag-passwords.forum.tags_page.group_protected"),isVisible:1==this.tag.isProtectedTagDisplayedForTagsPage()})),window.addEventListener("resize",(function(){m.redraw()}))},a.view=function(){var t=this.tag;return t?this.tagLocked&&!this.tagLocked.isVisible?null:(this.compactMobileMode=!!p().forum.attribute("categories.compactMobile"),m("li",{className:L()("TagCategory","TagCategory-"+t.slug(),{SubCategory:this.isChild,ParentCategory:!this.isChild,compactMobile:this.compactMobileMode})},this.categoryItems().toArray())):null},a.categoryItems=function(){var t=this,a=new(k()),o=this.tag,s=this.isChild?[]:A()(o.children()||[]);return a.add("link",m(U(),{className:"TagCategory-content "+(p().forum.attribute("categories.compactMobile")?"compactMobile":"")+" TagCategory-content-"+o.slug(),style:this.isChild?{}:{backgroundColor:o.color()},href:p().route.tag(o)},this.contentItems().toArray()),100),this.compactMobileMode||this.isChild||a.add("children",m("ol",{className:"TagCategory-subTagList"},s.map((function(a){return[e.component({model:a,parent:t})]}))),10),a},a.contentItems=function(){var t=this,a=new(k()),o=this.tag,s=this.isChild?[]:A()(o.children()||[]),r=this.isChild?"text-contrast--dark":Q()(o.color());return a.add("alignStart",m("div",{className:L()("TagCategory-alignStart",r)},this.alignStartItems().toArray()),100),a.add("alignEnd",m("div",{className:L()("TagCategory-alignEnd",r)},this.alignEndItems().toArray()),50),!this.isChild&&this.compactMobileMode&&!this.collapsed&&a.add("children",m("ol",{className:"TagCategory-subTagList"},s.map((function(a){return[e.component({model:a,parent:t})]}))),10),a},a.alignStartItems=function(){var t=this,e=new(k()),a=this.tag,o=this.isChild?[]:A()(a.children()||[]);return e.add("icon",m("span",{className:"TagCategory-icon"},this.iconItems().toArray()),100),e.add("main",m("div",{className:"TagCategory-main"},this.mainItems().toArray()),50),o.length&&e.add("toggleArrow",m("button",{className:"TagCategory-toggleArrow Button--ua-reset",onclick:function(e){t.toggleArrow(e)}},W()(this.collapsed?"fas fa-caret-down":"fas fa-caret-up")),10),e},a.alignEndItems=function(){var t=new(k());if(this.tagLocked)return t.add("locked",m("div",{className:"TagCategory-locked"},this.lockedItems().toArray()),100),t;var e=this.tag;return t.add("stats",m("div",{className:"TagCategory-stats StatWidgetList"},this.statItems().toArray()),100),t.add("lastDiscussion",m("div",{className:L()("TagCategory-lastDiscussion",{empty:!e.lastPostedDiscussion()})},this.lastDiscussionItems().toArray()),50),t},a.lockedItems=function(){var t=new(k()),e=this.compactMobileMode?"fa-stack fa-1x":"fa-stack fa-2x";return t.add("icon",m("span",{className:e},m("i",{className:"fa-stack-2x",style:{color:this.tag.color()}}),this.tagLocked.icon),10),t.add("LockedText",m("div",{className:L()("TagCategory-lockedText")},this.tagLocked.text),50),t},a.iconItems=function(){var t=new(k());if(this.tag.icon()&&this.isChild){var e={},a="fa-stack-1x CategoryIcon";p().forum.attribute("categories.childBareIcon")?(a+=" NoBackgroundCategoryIcon",e.color="#fafafa"):e.color=this.tag.color();var o=this.compactMobileMode?"fa-stack fa-1x":"fa-stack fa-2x";t.add("icon",m("span",{className:o},!!p().forum.attribute("categories.childBareIcon")&&m("i",{className:"fa fa-circle fa-stack-2x icon-background",style:{color:this.tag.color()}}),W()(this.tag.icon(),{className:a,style:e})),10)}else if(this.tag.icon()&&!p().forum.attribute("categories.parentRemoveIcon")){var s=this.compactMobileMode?"fa-stack fa-2x":"fa-stack fa-3x";t.add("icon",m("span",{className:s},W()(this.tag.icon(),{className:"fa-stack-1x CategoryIcon"})),10)}return t},a.mainItems=function(){var t=new(k());return t.add("name",m("h4",{className:"TagCategory-name"},this.tag.name()),15),!this.tag.description()||!this.isChild&&p().forum.attribute("categories.parentRemoveDescription")||t.add("description",m("div",{className:"TagCategory-description",style:"text-contrast--light"==Q()(this.tag.color())?"filter: brightness(85%);":"filter: brightness(200%);"},this.tag.description()),10),t},a.statItems=function(){var t=new(k()),e="text-contrast--light"==Q()(this.tag.color())?"filter: brightness(85%);":"filter: brightness(200%);";return!this.isChild&&p().forum.attribute("categories.parentRemoveStats")||(t.add("discussionCount",j.component({count:Intl.NumberFormat().format(this.tag.discussionCount()),label:p().translator.trans("askvortsov-categories.forum.stat-widgets.discussion_label"),icon:"fas fa-file-alt",filter:e}),15),t.add("postCount",j.component({count:Intl.NumberFormat().format(this.tag.postCount()),label:p().translator.trans("askvortsov-categories.forum.stat-widgets.post_label"),icon:"fas fa-comment",filter:e}),10)),t},a.lastDiscussionItems=function(){var t=new(k());return!this.isChild&&p().forum.attribute("categories.parentRemoveLastDiscussion")||t.add("lastDiscussion",X.component({discussion:this.tag.lastPostedDiscussion(),selectedTag:{tag:this.tag,isChild:this.isChild}}),10),t},a.oncreate=function(e){t.prototype.oncreate.call(this,e),this.$(".TagCategory-content,.TagCategory-toggleArrow").on("mouseenter",(function(t){$(this).addClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").removeClass("hover")})),this.$(".TagCategory-content,.TagCategory-toggleArrow").on("mouseleave",(function(t){$(this).removeClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").addClass("hover")}))},a.onremove=function(e){t.prototype.onremove.call(this,e),this.$(".TagCategory-content,.TagCategory-toggleArrow").off("mouseenter"),this.$(".TagCategory-content,.TagCategory-toggleArrow").off("mouseleave")},a.toggleArrow=function(t){t.preventDefault(),t.stopPropagation(),this.collapsed=!this.collapsed,m.redraw()},e}(S()),Z=function(t){function e(){for(var e,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).tags=void 0,e.loading=void 0,e}g(e,t);var a=e.prototype;return a.oninit=function(e){var a=this;t.prototype.oninit.call(this,e),p().history.push("categories",I()(p().translator.trans("askvortsov-category.forum.header.back_to_categories_tooltip"))),this.tags=[];var o=p().preloadedApiDocument();o?this.tags=A()(o.filter((function(t){return!t.isChild()}))):(this.loading=!0,p().tagList.load(["parent","children","lastPostedDiscussion","lastPostedDiscussion.lastPostedUser"]).then((function(){a.tags=A()(p().store.all("tags").filter((function(t){return!t.isChild()}))),a.loading=!1,m.redraw()})))},a.view=function(){return this.loading?m(C(),null):m("div",{className:L()(["CategoriesPage","container"])},this.pageItems().toArray())},a.pageItems=function(){var t=new(k());return t.add("hero",s().prototype.hero(),100),t.add("container",this.containerItems().toArray(),50),t},a.containerItems=function(){var t=new(k()),e=s().prototype.view();return t.add("container",m("div",{className:p().forum.attribute("categories.fullPageDesktop")?"container topNavContainer":"container sideNavContainer"},this.contentItems().toArray()),50),(p().forum.attribute("categories.widgetHeader")||p().forum.attribute("categories.widgetFooter"))&&e.children.length>1&&e.children[1].children&&e.children[1].children.forEach((function(e,a){e.attrs.className||(p().forum.attribute("categories.widgetHeader")&&0==a?t.add("header-widget",e,100):p().forum.attribute("categories.widgetFooter")&&t.add("footer-widget",e,0))})),t},a.contentItems=function(){var t=new(k()),e=this.tags.filter((function(t){return null!==t.position()})),a=this.tags.filter((function(t){return null===t.position()}));if(t.add("sideNav",m("nav",{className:p().forum.attribute("categories.fullPageDesktop")?"CategoriesPage-nav IndexPage-nav topNav":"CategoriesPage-nav IndexPage-nav sideNav"},m("ul",null,w()(s().prototype.sidebarItems().toArray()))),100),t.add("categoriesList",m("div",{className:"CategoriesPage-content sideNavOffset"},m("ol",{className:"TagCategoryList"},e.map((function(t){return Y.component({model:t})}))),a.length?m("div",{className:"TagCloud"},a.map((function(t){return[M()(t,{link:!0})," "]}))):""),50),p().forum.attribute("categories.widgetRight")){var o=s().prototype.view();o.children.length>1&&o.children[1].children.length>1&&3===o.children[1].children[1].children.length&&t.add("widget",o.children[1].children[1].children[2],0)}return t},a.oncreate=function(e){t.prototype.oncreate.call(this,e),p().setTitle(I()(p().translator.trans("askvortsov-categories.forum.all_categories.meta_title_text")))},e}(v());const tt=flarum.core.compat["tags/forum/components/TagsPage"];var et=t.n(tt);function at(t,e){var a=app.forum.attribute("categories.keepTagsNav"),o=app.current.matches(Z)||app.current.matches(et());for(var s in t.items)e(s)&&(s.startsWith("tag")?"tags"==s?a||t.remove(s):o&&t.remove(s):app.forum.attribute("categories.widgetLeft")||t.remove(s));return t}flarum.core.compat["extensions/afrux-forum-widgets-core/common/utils/sortWidgets"],app.initializers.add("askvortsov/flarum-categories",(function(){app.routes.categories={path:"/categories",component:Z},d().prototype.postCount=c().attribute("postCount"),(0,a.extend)(s().prototype,"navItems",(function(t){return t.add("categories",m(i(),{icon:"fas fa-th-list",href:app.route("categories")},app.translator.trans("askvortsov-categories.forum.index.categories_link")),-9.5),app.current.matches(Z)||app.current.matches(et())?t.remove("moreTags"):t.has("moreTags")&&t.replace("moreTags",m(i(),{href:app.route("categories")},app.translator.trans("flarum-tags.forum.index.more_link"))),at(t,(function(t){return t.startsWith("tag")})),t})),(0,a.extend)(s().prototype,"sidebarItems",(function(t){at(t,(function(t){return"newDiscussion"!==t&&"nav"!==t}))}))}));const ot={"components/CategoriesPage":Z,"components/Category":Y,"components/LastDiscussionWidget":X,"components/StatWidget":j}})(),module.exports=e})();
//# sourceMappingURL=forum.js.map